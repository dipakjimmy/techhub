<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Blog — List</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <link rel="stylesheet" href="assets/css/main.css"> <!-- adjust if your main.css path differs -->
  <style>
    /* small local styles so it looks OK even if your main.css differs */
    .container{max-width:1100px;margin:28px auto;padding:0 16px;}
    .grid{display:grid;grid-template-columns:repeat(2,1fr);gap:18px;}
    @media(max-width:760px){.grid{grid-template-columns:1fr}}
    .card{background:#fff;border:1px solid #ececec;padding:18px;border-radius:8px;}
    .card img{width:100%;height:180px;object-fit:cover;border-radius:6px;margin-bottom:12px}
    .meta{font-size:13px;color:#6b6b6b;margin-bottom:8px}
    .title{font-size:18px;margin:0 0 8px}
    .excerpt{color:#4b5563}
  </style>
</head>
<body>
  <div class="container">
    <h1>Blog</h1>
    <div id="posts" class="grid">Loading posts…</div>
  </div>

<script>
async function loadPosts(){
  try{
    const res = await fetch('fetch_blogs.php', {cache:'no-cache'});
    const data = await res.json(); // always valid JSON now
    if (data.errors && data.errors.length) {
      console.warn('fetch_blogs errors:', data.errors);
      // show on page but still try to show posts
      document.getElementById('posts').innerHTML = '<div style="color:#b00;margin-bottom:12px">Errors: ' + data.errors.join('; ') + '</div>';
    }
    const posts = data.posts || [];
    const container = document.getElementById('posts');
    if(!posts.length){ container.innerHTML += '<p>No posts found.</p>'; return; }
    container.innerHTML += '';
    posts.forEach(p=>{
      const el = document.createElement('article');
      el.className = 'card';
      el.innerHTML = `
        ${p.image ? `<img src="${p.image}" alt="${p.title}">` : ''}
        <div class="meta">${new Date(p.date).toLocaleDateString()}</div>
        <h2 class="title">${p.title}</h2>
        <div class="excerpt">${p.excerpt}</div>
        <p style="margin-top:12px;"><a href="single.php?slug=${encodeURIComponent(p.slug)}">Read more →</a></p>
      `;
      container.appendChild(el);
    });
  } catch(err){
    document.getElementById('posts').innerText = 'Error loading posts: ' + err;
    console.error(err);
  }
}
loadPosts();
</script>
</body>
</html>
